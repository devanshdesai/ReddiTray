{"version":3,"sources":["RedditRequest.js"],"names":[],"mappings":"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","file":"RedditRequest.js","sourcesContent":["\n// node modules\nimport util from 'util';\nimport events from 'events';\nimport urlLib from 'url';\n\n// npm modules\nimport when from 'when';\nimport delay from 'when/delay';\nimport he from 'he';\n\n// our modules\nimport Request from './Request';\nimport Endpoint from './Endpoint';\nimport ResponseError from './ResponseError';\n\n/*\n   A collection of functions that deal with requesting data from the\n   reddit API.\n */\nexport default class RedditRequest extends events.EventEmitter {\n\n  constructor(userConfig, request, oauth, oauthAppOnly, modhash) {\n    super();\n    this._request = request;\n    this._userConfig = userConfig;\n    this._oauth = oauth;\n    this._oauthAppOnly = oauthAppOnly;\n    this._modhash = modhash;\n  }\n\n  /*\n     Currently application only?\n\n     If we do not have an access token and there is no way\n     to get a new access token then yes! We are application\n     only oauth.\n   */\n  isApplicationOnly() {\n    return !this._oauth.hasAccessToken() && !this._oauth.canRefreshAccessToken();\n  }\n\n  /*\n     Are we currently authenticated?\n   */\n  isAuthenticated() {\n    return this.isApplicationOnly() ?\n           this._oauthAppOnly.hasAccessToken() :\n           this._oauth.hasAccessToken();\n  }\n\n  /*\n     Builds up the headers for an endpoint.\n   */\n  buildHeaders(contextOptions={}) {\n    let headers = {};\n\n    if (this._userConfig.isNode) {\n      // Can't set User-Agent in browser\n      headers['User-Agent'] = this._userConfig.userAgent;\n    }\n\n    if (this._userConfig.useBrowserCookies) {\n      headers['X-User-Agent'] = this._userConfig.userAgent;\n\n      if (this._modhash.hasModhash() && !this._modhash.isModhashOld()) {\n        headers['X-Modhash'] = this._modhash.getCurrentModhash();\n      }\n    }\n\n    if (!this._userConfig.useBrowserCookies) {\n      if (contextOptions.bypassAuth || this.isApplicationOnly()) {\n        headers['Authorization'] = this._oauthAppOnly.getAuthorizationHeader();\n      } else {\n        headers['Authorization'] = this._oauth.getAuthorizationHeader();\n      }\n    }\n\n    return headers;\n  }\n\n  /*\n     Call the reddit api.\n   */\n  callRedditApi(endpoint) {\n    // Authenticate if needed before making a call.\n    //\n    // Eliminates unwanted 401 errors when making initial calls\n    // on Application only OAuth & Script instances where calling\n    // `.auth()` isn't required.\n    let auth = this.isAuthenticated() ? when.resolve() : (() => {\n      return this.authenticate(endpoint).then(() => {\n        // rebuild endpoint with new headers\n        endpoint = new Endpoint(this._userConfig,\n                                 endpoint.hostname,\n                                 endpoint.method,\n                                 endpoint.path,\n                                 this.buildHeaders(\n                                   endpoint.contextOptions),\n                                 endpoint.givenArgs,\n                                 endpoint.contextOptions,\n                                 endpoint.port);\n\n      });\n    })();\n\n    return auth.then(() => {\n      let requestPromise = this._request.https(\n        endpoint, this.responseErrorHandler.bind(this));\n\n      return requestPromise.then(response => {\n        return this.handleSuccessResponse(response, endpoint);\n      });\n    });\n  }\n\n  /*\n     Authenticate with the appropriate OAuth type for a given\n     endpoint\n   */\n  authenticate(endpoint) {\n    let authPromise;\n\n    // If we are application only, or are bypassing authentication\n    // therefore we're using application only OAuth\n    if (this._userConfig.useBrowserCookies) {\n      if (endpoint.method === 'post') {\n        authPromise = this._modhash.getModhash();\n      } else {\n        authPromise = when.resolve();\n      }\n    }\n    else if (this.isApplicationOnly() || endpoint.contextOptions.bypassAuth) {\n      authPromise = this._oauthAppOnly.applicationOnlyAuth();\n    }\n    else if (this._oauth.canRefreshAccessToken()) {\n      // If we have been authenticated with a permanent refresh token use it\n      if (this._oauth.hasRefreshToken()) {\n        authPromise = this._oauth.refresh();\n      }\n      // If we are OAuth type script we can call `.auth` again\n      else if (this._userConfig.isOAuthType('script')) {\n        authPromise = this._oauth.auth();\n      }\n    }\n    // No way to authenticate\n    else {\n      return when.reject(new Error('Unable to authenticate'));\n    }\n\n    return authPromise;\n  }\n\n  /*\n     Handle a request errors from reddit. This is usually caused when our\n     access_token has expired, or reddit servers are under heavy load.\n\n     If we can't renew our access token, we throw an error / emit the\n     'access_token_expired' event that users can then handle to\n     re-authenticatet clients\n\n     If we can renew our access token, we try to reauthenticate, and call the\n     reddit endpoint again.\n   */\n  responseErrorHandler(response, endpoint) {\n\n    // - - -\n    // Check headers for more specific errors.\n\n    let wwwAuth = response._headers['www-authenticate'];\n\n    if (wwwAuth && wwwAuth.indexOf('insufficient_scope') !== -1) {\n      return when.reject(new ResponseError(\n        'Insufficient scopes provided for this call',\n        response,\n        endpoint));\n    }\n\n    // - - -\n    // 404 - Page not found\n    if (response._status === 404) {\n      let msg = 'Page not found. Is this a valid endpoint?';\n      return when.reject(new ResponseError(msg, response, endpoint));\n    }\n\n    // - - -\n    // Access token has expired\n    if (response._status === 401 && !this._userConfig.useBrowserCookies) {\n\n      // Atempt to get a new access token!\n      let reauthPromise = this.authenticate(endpoint);\n\n      return reauthPromise.then(() => {\n        // refresh the authentication headers for this endpoint\n        endpoint.setHeaders(this.buildHeaders(endpoint.contextOptions));\n\n        let modifiedEndpoint = new Endpoint(this._userConfig,\n                                            endpoint.hostname,\n                                            endpoint.method,\n                                            endpoint.path,\n                                            this.buildHeaders(\n                                              endpoint.contextOptions),\n                                            endpoint.givenArgs,\n                                            endpoint.contextOptions,\n                                            endpoint.port);\n\n        return when.resolve(modifiedEndpoint);\n      }).catch(error => {\n        this.emit('access_token_expired');\n\n        let msg = 'Access token has expired. Listen for ' +\n                   'the \"access_token_expired\" event to ' +\n                     'handle this gracefully in your app.';\n        return when.reject(new ResponseError(msg, response, endpoint));\n      });\n    }\n\n    // - - -\n    // Access token has expired and we're trying to authenticate without OAuth\n    if (response._status === 401 && !this._userConfig.useBrowserCookies) {\n      let msg = 'Access token required to access this endpoint.';\n      return when.reject(new ResponseError(msg, response, endpoint));\n    }\n\n    // - - -\n    // Reddit servers are busy. Can't do much here.\n\n    if (String(response._status).substring(0, 1) === '5') {\n      let modifiedEndpoint = new Endpoint(this._userConfig,\n                                          endpoint.hostname,\n                                          endpoint.method,\n                                          endpoint.path,\n                                          this.buildHeaders(\n                                            endpoint.contextOptions),\n                                          endpoint.givenArgs,\n                                          endpoint.contextOptions,\n                                          endpoint.port);\n\n      return when.resolve(modifiedEndpoint);\n    }\n\n    // - - -\n    // At the end of the day, we just throw an error stating that there\n    // is nothing we can do & give general advice\n    return when.reject(new ResponseError(\n      ('This call failed. ' +\n       'Does this call require a user? ' +\n       'Is the user missing reddit gold? ' +\n       'Trying to change a subreddit that the user does not moderate? ' +\n       'This is an unrecoverable error. Check the rest of the ' +\n       'error message for more information.'),\n      response,\n      endpoint));\n  }\n\n  /*\n     Handle reddit response status of 2xx.\n\n     Finally return the data if there were no problems.\n   */\n  handleSuccessResponse(response, endpoint) {\n\n    let data = response._body || '';\n\n    if (endpoint.contextOptions.decodeHtmlEntities) {\n      data = he.decode(data);\n    }\n\n    // Attempt to parse some JSON, otherwise continue on (may be empty, or text)\n    try {\n      data = JSON.parse(data);\n\n      // Reddit isn't always honest in their response status. Check for\n      // any errors in 2xx http statuses\n\n      // data.json.errors\n      if (data.json && data.json.errors && data.json.errors.length > 0) {\n        return when.reject(new ResponseError('', response, endpoint));\n      }\n\n      // data.json.error\n      if (data.json && data.json.error) {\n        return when.reject(new ResponseError('', response, endpoint));\n      }\n\n    } catch(e) {}\n\n\n    let rateLimitRemaining = response._headers['x-ratelimit-remaining'];\n    let rateLimitUsed = response._headers['x-ratelimit-used'];\n    let rateLimitReset = response._headers['x-ratelimit-reset'];\n\n    let rateLimitData = {\n      rateLimitRemaining: rateLimitRemaining ? Number(rateLimitRemaining) : void 0,\n      rateLimitUsed: rateLimitUsed ? Number(rateLimitUsed) : void 0,\n      rateLimitReset: rateLimitReset ? Number(rateLimitReset) : void 0\n    };\n\n    if (typeof rateLimitData.rateLimitUsed !== 'undefined') {\n      this.emit('rate_limit', rateLimitData);\n    }\n\n    // Using a test variable\n    // this._userConfig.__test.rateLimitRemainingCutoff\n    // it's default value is \"0\", however in the tests cases this\n    // would take too long.\n    let cutoff = this._userConfig.__test.rateLimitRemainingCutoff;\n\n    if (typeof rateLimitData.rateLimitRemaining !== 'undefined' &&\n      Number(rateLimitRemaining) <= cutoff)\n    {\n      this.emit('rate_limit_reached', rateLimitData);\n    }\n\n    if (this._userConfig.useBrowserCookies && data.data &&\n        data.data.modhash && data.data.modhash.length) {\n      this._modhash.setModhash(data.data.modhash);\n    }\n\n    return when.resolve(data);\n  }\n\n  /*\n     Listing support.\n   */\n  getListing(endpoint) {\n\n    // number of results that we have loaded so far. It will\n    // increase / decrease when calling next / previous.\n    let count = 0;\n    let limit = endpoint.args.limit || 25;\n    // keep a reference to the start of this listing\n    let start = endpoint.args.after || null;\n\n    let getSlice = (endpoint) => {\n\n      return this.callRedditApi(endpoint).then((result={}) => {\n\n        let slice = {};\n        let listing = result;\n\n        slice.get = result;\n\n        if (result instanceof Array) {\n          if (typeof endpoint.contextOptions.listingIndex === 'undefined') {\n            throw new Error('Must specify a `listingIndex` for this listing.');\n          }\n\n          listing = result[endpoint.contextOptions.listingIndex];\n        }\n\n        slice.count = count;\n\n        slice.before = listing.data.before || null;\n        slice.after = listing.data.after || null;\n        slice.allChildren = listing.data.children || [];\n\n        slice.empty = slice.allChildren.length === 0;\n\n        slice.children = slice.allChildren.filter(function(child) {\n          child.data = child.data || {};\n          return !child.data.stickied;\n        });\n\n        slice.stickied = slice.allChildren.filter(function(child) {\n          child.data = child.data || {};\n          return child.data.stickied;\n        });\n\n        slice.next = () => {\n          count += limit;\n\n          let newArgs = endpoint.givenArgs;\n          newArgs.before = null;\n          newArgs.after = slice.children[slice.children.length - 1].data.name;\n          newArgs.count = count;\n          return getSlice(new Endpoint(this._userConfig,\n                                       endpoint.hostname,\n                                       endpoint.method,\n                                       endpoint.path,\n                                       this.buildHeaders(endpoint.contextOptions),\n                                       newArgs,\n                                       endpoint.contextOptions,\n                                       endpoint.port));\n        };\n\n        slice.previous = () => {\n          count -= limit;\n\n          let newArgs = endpoint.givenArgs;\n          newArgs.before = slice.children[0].data.name;\n          newArgs.after = null;\n          newArgs.count = count;\n          return getSlice(new Endpoint(this._userConfig,\n                                       endpoint.hostname,\n                                       endpoint.method,\n                                       endpoint.path,\n                                       this.buildHeaders(endpoint.contextOptions),\n                                       newArgs,\n                                       endpoint.contextOptions,\n                                       endpoint.port));\n        };\n\n        slice.start = () => {\n          count = 0;\n\n          let newArgs = endpoint.givenArgs;\n          newArgs.before = null;\n          newArgs.after = start;\n          newArgs.count = count;\n          return getSlice(new Endpoint(this._userConfig,\n                                       endpoint.hostname,\n                                       endpoint.method,\n                                       endpoint.path,\n                                       this.buildHeaders(endpoint.contextOptions),\n                                       newArgs,\n                                       endpoint.contextOptions,\n                                       endpoint.port));\n        };\n\n        slice.requery = () => {\n          return getSlice(endpoint);\n        };\n\n        return slice;\n      });\n\n    };\n\n    return getSlice(endpoint);\n  }\n\n  /*\n     Enable path syntax support, e.g. this.path('/path/to/$endpoint/etc')\n\n     Can take an url as well, but the first part of the url is chopped\n     off because it is not needed. We will always use the server oauth\n     to call the API...\n\n     e.g. https://www.example.com/api/v1/me\n\n     will only use the path: /api/v1/me\n   */\n  path(urlOrPath) {\n\n    let parsed = urlLib.parse(urlOrPath);\n    let path = parsed.pathname;\n\n    let calls = {};\n\n    ['get', 'post', 'put', 'patch', 'delete', 'update'].forEach(verb => {\n      calls[verb] = (userGivenArgs, userContextOptions) => {\n        return this.callRedditApi(new Endpoint(this._userConfig,\n                                               this._userConfig.serverOAuth,\n                                               verb,\n                                               path,\n                                               this.buildHeaders(userContextOptions),\n                                               userGivenArgs,\n                                               userContextOptions,\n                                               this._userConfig.serverOAuthPort));\n      };\n    });\n\n    // Add listing support\n    calls.listing = (userGivenArgs, userContextOptions) => {\n      return this.getListing(new Endpoint(this._userConfig,\n                                          this._userConfig.serverOAuth,\n                                          'get',\n                                          path,\n                                          this.buildHeaders(userContextOptions),\n                                          userGivenArgs,\n                                          userContextOptions,\n                                          this._userConfig.serverOAuthPort));\n    };\n\n    return calls;\n  }\n\n}\n"],"sourceRoot":"/source/"}