{"version":3,"sources":["UserConfig.js"],"names":[],"mappings":"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","file":"UserConfig.js","sourcesContent":["import * as u from './utils';\n\n/*\n   A class made up of the user configuration.\n\n   Normalizes the configuraiton & checks for simple errors.\n\n   Provides some helper functons for getting user set values.\n */\n\nexport default class UserConfig {\n  constructor(userConfiguration) {\n\n    //\n    // - - - CONFIGURATION VALUES - - -\n    //\n\n    var missingMsg = 'Missing required userConfiguration value ';\n\n    // ** IDENFIFICATION\n    this.userAgent = u.thisOrThrow(\n      userConfiguration.userAgent,\n      'Missing required userConfiguration value `userAgent`');\n\n    this.isNode = u.thisOrThat(userConfiguration.browser, u.isNode());\n\n    this.mobile = u.thisOrThat(userConfiguration.mobile, false);\n\n    this.useBrowserCookies = u.thisOrThat(userConfiguration.useBrowserCookies, false);\n\n    if (userConfiguration.apiServerUri) {\n      userConfiguration.serverOAuth = userConfiguration.apiServerUri;\n    }\n\n    if (userConfiguration.authServerUri) {\n      userConfiguration.serverWWW = userConfiguration.authServerUri;\n    }\n\n    // ** SERVERS\n    if (this.useBrowserCookies) {\n      this.serverOAuth = u.thisOrThat(userConfiguration.serverOAuth,\n                                      'www.reddit.com');\n    } else {\n      this.serverOAuth = u.thisOrThat(userConfiguration.serverOAuth,\n                                      'oauth.reddit.com');\n    }\n\n    this.serverWWW = u.thisOrThat(userConfiguration.serverWWW,\n                                  'www.reddit.com');\n    this.serverOAuthPort = u.thisOrThat(userConfiguration.serverOAuthPort, 80);\n    this.serverWWWPort = u.thisOrThat(userConfiguration.serverWWWPort, 80);\n\n    // ** CALL MODIFICATIONS\n    this.throttle = u.thisOrThat(userConfiguration.throttle, 1000);\n\n    this.decodeHtmlEntities = u.thisOrThat(\n      userConfiguration.decodeHtmlEntities,\n      false);\n\n    this.apiType = u.thisOrThat(userConfiguration.apiType, 'json');\n\n\n    // ** RETRY ATTEMPTS\n    this.retryAttempts = u.thisOrThat(userConfiguration.retryAttempts, 60);\n\n    this.retryDelay = u.thisOrThat(userConfiguration.retryDelay, 5000);\n\n    this.requestTimeout = u.thisOrThat(userConfiguration.requestTimeout, 20000);\n\n\n    // ** OAUTH\n    this.oauth = u.thisOrThat(userConfiguration.oauth, {});\n\n    this.oauth.scope = u.thisOrThat(this.oauth.scope, []);\n\n    this.oauth.deviceId = u.thisOrThat(this.oauth.deviceId,\n                                       'DO_NOT_TRACK_THIS_DEVICE');\n    this.oauth.duration = u.thisOrThat(this.oauth.duration, 'temporary');\n\n    if (this.useBrowserCookies) {\n      this.oauth.type = u.thisOrThat(this.oauth.type, '');\n      this.oauth.key = u.thisOrThat(this.oauth.key, '');\n    } else {\n      this.oauth.type = u.thisOrThrow(this.oauth.type,\n                                      missingMsg + '`oauth.type`');\n      this.oauth.key = u.thisOrThrow(this.oauth.key,\n                                     missingMsg + '`oauth.key`');\n    }\n\n\n    //\n    // - - - VALIDATION\n    //\n\n    if (this.oauth.duration !== 'temporary' &&\n      this.oauth.duration !== 'permanent')\n    {\n      throw new Error(\n        'Invalid `oauth.duration`. Must be one of: permanent, temporary');\n    }\n\n    if (this.oauth.deviceId !== 'DO_NOT_TRACK_THIS_DEVICE' &&\n      (this.oauth.deviceId.length < 20 || this.oauth.deviceId.length > 30)) {\n        throw new Error(\n          'Invalid device_id length. Must be 20-30 characters');\n    }\n\n    if (!this.isOAuthType('explicit') &&\n      !this.isOAuthType('implicit') &&\n      !this.isOAuthType('script') &&\n      !this.useBrowserCookies)\n    {\n      throw new Error(\n        'Invalid `oauth.type`. Must be one of: explicit, implicit, or script');\n    }\n\n    if (!this.useBrowserCookies) {\n      if (this.isOAuthType('explicit') || this.isOAuthType('script')) {\n        this.oauth.secret = u.thisOrThrow(\n          this.oauth.secret,\n          missingMsg + '`oauth.secret` for type explicit/script');\n      }\n\n\n      if (this.isOAuthType('script')) {\n        this.oauth.username = u.thisOrThrow(\n          this.oauth.username,\n          missingMsg + '`oauth.username` for type script');\n        this.oauth.password = u.thisOrThrow(\n          this.oauth.password,\n          missingMsg + '`oauth.password` for type script');\n      }\n\n      if (this.isOAuthType('implicit') || this.isOAuthType('explicit')) {\n        this.oauth.redirectUri = u.thisOrThrow(\n          this.oauth.redirectUri,\n          missingMsg + '`oauth.redirectUri` for type implicit/explicit');\n      }\n    }\n\n\n    //\n    // TESTING CONFIGURATION\n    //\n    // Some test cases require some deep messing around with the library\n    // in order to be nice to the API server when testing.\n    //\n    // These should never be used by anything other than the test cases to\n    // modify internal variables. They are only used if needed!\n\n    /*\n       Used to determine when we have gone over the rate limit. The default\n       would be \"0\", e.g. when there are not more requests remaining in the\n       current time slot\n     */\n    this.__test = {};\n    userConfiguration.__test = userConfiguration.__test || {};\n\n    this.__test.rateLimitRemainingCutoff = u.thisOrThat(\n      userConfiguration.__test.rateLimitRemainingCutoff, 0);\n  }\n\n  /*\n     Checks if the oauth is of a specific type, e.g.\n\n     isOAuthType('script')\n   */\n  isOAuthType(type) {\n    return this.oauth.type === type;\n  }\n\n}\n"],"sourceRoot":"/source/"}